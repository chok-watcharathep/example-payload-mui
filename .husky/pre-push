#!/bin/bash

# Define the regex for branch naming convention
BRANCH_REGEX="^(feature|bugfix|hotfix|release|dev|setup|base|refactor|story)\/[a-zA-Z0-9._-]+$"

# Get the current branch name
BRANCH_NAME=$(git symbolic-ref --short HEAD)

# Run typecheck
pnpm run type-check

# Run linting
pnpm run lint

# Run code formatting
pnpm run format

# Run testing
pnpm run test


# TODO: Remove temporary branch main, dev
# Allow branch main, dev for temporary
if [[ ! $BRANCH_NAME =~ $BRANCH_REGEX && $BRANCH_NAME != "main" && $BRANCH_NAME != "dev" ]]; then
    echo "Error: Branch name '$BRANCH_NAME' does not follow the naming convention."
    echo "Please use one of the following prefixes: feature/, bugfix/, hotfix/, release/, dev/, setup/, base/, refactor/, story/"
    exit 1
fi